<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bingo Party</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@700&display=swap" rel="stylesheet">
    <style>
        /* ä¿æŒåŸæœ¬æ¼‚äº®çš„æ¨£å¼ */
        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Microsoft JhengHei', sans-serif; background-color: #121212; color: #fff; margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden; }
        
        #login-screen { display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100%; height: 100%; padding: 30px; background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); z-index: 10; }
        .logo-title { font-size: 40px; font-weight: bold; margin-bottom: 40px; letter-spacing: 2px; }
        input#nickname { width: 100%; max-width: 300px; padding: 15px; font-size: 24px; border: none; border-radius: 50px; text-align: center; margin-bottom: 20px; outline: none; }
        button.btn-join { width: 100%; max-width: 300px; padding: 15px; font-size: 24px; background: #00e676; color: #004d40; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; }
        
        #game-screen { display: none; width: 100%; height: 100%; flex-direction: column; align-items: center; padding: 10px; max-width: 500px; }
        .top-bar { width: 100%; display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; background: #1e1e1e; border-radius: 15px; margin-bottom: 10px; }
        .status-badge { padding: 5px 12px; border-radius: 20px; font-size: 14px; background: #333; color: #777; }
        .status-badge.reach { background: #ff9800; color: white; animation: blink 1s infinite; }
        .status-badge.bingo { background: #f44336; color: white; }
        @keyframes blink { 50% { opacity: 0.7; } }
        
        .latest-number-area { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 10px; }
        .latest-ball { width: 60px; height: 60px; border-radius: 50%; background: #2980b9; color: white; font-size: 32px; font-family: 'Roboto Mono', monospace; display: flex; align-items: center; justify-content: center; border: 3px solid #3498db; }
        
        .grid-container { width: 100%; aspect-ratio: 1; padding: 10px; background: #222; border-radius: 15px; display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; }
        .cell { background: #333; border-radius: 8px; display: flex; justify-content: center; align-items: center; font-size: 20px; font-weight: bold; color: #ddd; transition: 0.3s; }
        .cell.marked { background: #00e676; color: #004d40; transform: scale(0.95); }
        .cell.just-marked { animation: pop 0.5s; }
        @keyframes pop { 0% { transform: scale(1); background: white; } 50% { transform: scale(1.2); } 100% { transform: scale(0.95); background: #00e676; } }

        #win-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 99; flex-direction: column; justify-content: center; align-items: center; }
    </style>
</head>
<body>
    <div id="login-screen">
        <div class="logo-title">BINGO PARTY</div>
        <input type="text" id="nickname" placeholder="è¼¸å…¥ä½ çš„æš±ç¨±" maxlength="8">
        <button class="btn-join" onclick="joinGame()">ğŸš€ åŠ å…¥éŠæˆ²</button>
    </div>

    <div id="game-screen">
        <div class="top-bar">
            <div style="font-size:18px; color:#aaa;" id="display-name"></div>
            <div class="status-badge" id="status-badge">é€²è¡Œä¸­</div>
        </div>
        <div class="latest-number-area">
            <span style="font-size:16px; color:#888;">æœ€æ–°è™Ÿç¢¼</span>
            <div class="latest-ball" id="latest-num">--</div>
        </div>
        <div class="grid-container" id="bingo-card"></div>
        <p style="color:#555; font-size:12px; margin-top:20px;">ç­‰å¾…é–‹ç...</p>
    </div>

    <div id="win-overlay">
        <div style="font-size:60px; color:#f1c40f; font-weight:bold;">BINGO!</div>
        <div style="font-size:24px; color:white;">æ­å–œä½ ä¸­çäº†ï¼ğŸ‰</div>
    </div>

    <script>
        const socket = io();

        function joinGame() {
            const name = document.getElementById('nickname').value.trim();
            if(!name) return alert("è«‹è¼¸å…¥åå­—ï¼");
            document.getElementById('display-name').innerText = name;
            socket.emit('join_game', {nickname: name});
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'flex';
        }

        socket.on('init_game', (data) => { renderCard(data.card, data.drawn); });
        socket.on('error', (data) => { alert(data.msg); location.reload(); });

        function renderCard(card, drawn) {
            const grid = document.getElementById('bingo-card');
            grid.innerHTML = "";
            card.forEach(row => {
                row.forEach(num => {
                    let div = document.createElement('div');
                    div.className = 'cell'; div.id = 'cell-' + num;
                    if(num === 0) { div.innerHTML = "â˜…"; div.classList.add('marked'); }
                    else { div.innerText = num; if(drawn.includes(num)) div.classList.add('marked'); }
                    grid.appendChild(div);
                });
            });
        }

        socket.on('update_status', (data) => {
            document.getElementById('latest-num').innerText = data.new_number;
            let cell = document.getElementById('cell-' + data.new_number);
            if(cell) { cell.classList.add('marked', 'just-marked'); if(navigator.vibrate) navigator.vibrate(200); }
            
            const badge = document.getElementById('status-badge');
            if(data.status === "BINGO") {
                badge.innerText = "BINGO!"; badge.className = "status-badge bingo";
                document.getElementById('win-overlay').style.display = 'flex';
                if(navigator.vibrate) navigator.vibrate([200, 100, 200]);
            } else if(data.status === "REACH") {
                badge.innerText = "è½ç‰Œ!"; badge.className = "status-badge reach";
            }
        });

        // â˜… é—œéµä¿®å¾©ï¼šæ”¶åˆ°é‡ç½®è¨Šè™Ÿï¼Œå¼·åˆ¶é‡æ•´é é¢ï¼Œå›åˆ°è¼¸å…¥åå­—ç•«é¢
        socket.on('game_reset', () => {
            alert("éŠæˆ²å·²çµæŸä¸¦é‡ç½®ï¼Œè«‹é‡æ–°åŠ å…¥ï¼");
            window.location.reload();
        });
    </script>
</body>
</html>
