<!DOCTYPE html>
<html>
<head>
    <title>Bingo æ´»å‹•å¾Œå°</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; display: flex; gap: 20px; padding: 20px; background-color: #f0f2f5; height: 95vh; margin: 0; }
        
        /* å·¦å´æ§åˆ¶å€ */
        .control-panel { 
            flex: 1; background: white; padding: 20px; border-radius: 15px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        
        /* å³å´æ’è¡Œæ¦œ */
        .leaderboard-panel { 
            flex: 1; background: white; padding: 20px; border-radius: 15px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); overflow-y: auto; 
        }

        .big-number { 
            font-size: 180px; color: #2c3e50; font-weight: bold; margin: 20px 0; 
            line-height: 1; text-shadow: 2px 2px 0px #eee;
        }
        
        button { cursor: pointer; border: none; border-radius: 8px; font-weight: bold; transition: 0.2s; }
        button:active { transform: scale(0.98); }

        .btn-draw { 
            background: #3498db; color: white; font-size: 28px; padding: 20px 50px; 
            box-shadow: 0 4px #2980b9; margin-bottom: 20px;
        }
        .btn-reset { 
            background: #e74c3c; color: white; font-size: 16px; padding: 10px 20px; margin-top: auto; 
        }
        .btn-qr {
            background: #2ecc71; color: white; font-size: 18px; padding: 10px 25px; margin-bottom: 15px;
        }

        /* QR Code å€åŸŸ (é è¨­éš±è—) */
        #qr-area { display: none; text-align: center; margin: 20px; padding: 20px; border: 2px dashed #ccc; border-radius: 10px; }
        #join-link { word-break: break-all; color: #7f8c8d; margin-top: 10px; font-size: 12px; }

        /* æ’è¡Œæ¦œæ¨£å¼ */
        ul { list-style: none; padding: 0; width: 100%; }
        li { 
            padding: 15px; margin-bottom: 10px; background: #f8f9fa; border-radius: 8px; 
            display: flex; justify-content: space-between; align-items: center; font-size: 18px;
        }
        
        /* ç‹€æ…‹ç‰¹æ•ˆ */
        .status-bingo { 
            background: #e74c3c !important; color: white; animation: pulse 0.5s infinite alternate; 
            font-weight: bold; font-size: 22px;
        }
        .status-reach { 
            background: #f1c40f !important; color: #333; border: 2px solid #f39c12; 
            font-weight: bold;
        }
        
        @keyframes pulse { from { transform: scale(1); } to { transform: scale(1.02); } }

        .count-display { font-size: 24px; color: #7f8c8d; margin-bottom: 20px; }
        .count-num { color: #2c3e50; font-weight: bold; font-size: 32px; }
    </style>
</head>
<body>

    <div class="control-panel">
        <div class="count-display">ç›®å‰ç©å®¶æ•¸: <span id="p-count" class="count-num">0</span> äºº</div>
        
        <button class="btn-qr" onclick="toggleQR()">ğŸ“± é¡¯ç¤º/éš±è— QR Code</button>
        <div id="qr-area">
            <div id="qrcode"></div>
            <p id="join-link"></p>
        </div>

        <div>ç•¶å‰é–‹å‡ºè™Ÿç¢¼</div>
        <div class="big-number" id="current-num">--</div>
        
        <button class="btn-draw" onclick="drawRandom()">ğŸ² éš¨æ©Ÿé–‹è™Ÿ</button>
        <button class="btn-reset" onclick="resetGame()">âš ï¸ é‡ç½®éŠæˆ²</button>
    </div>

    <div class="leaderboard-panel">
        <h2 style="text-align:center; border-bottom: 2px solid #eee; padding-bottom: 10px;">ğŸ† å³æ™‚æˆ°æ³</h2>
        <ul id="leaderboard">
            </ul>
    </div>

    <script>
        const socket = io();
        let drawnNumbers = [];

        // QR Code åˆå§‹åŒ–
        const host = window.location.protocol + "//" + window.location.hostname + (window.location.port ? ':'+window.location.port : '');
        const playUrl = host + "/play";
        document.getElementById('join-link').innerText = playUrl;
        new QRCode(document.getElementById("qrcode"), {
            text: playUrl,
            width: 200,
            height: 200
        });

        // åˆ‡æ› QR Code é¡¯ç¤º
        function toggleQR() {
            const qrArea = document.getElementById('qr-area');
            if (qrArea.style.display === 'none' || qrArea.style.display === '') {
                qrArea.style.display = 'block';
            } else {
                qrArea.style.display = 'none';
            }
        }

        // éš¨æ©Ÿé–‹è™Ÿé‚è¼¯
        function drawRandom() {
            let available = [];
            for(let i=1; i<=75; i++) {
                if(!drawnNumbers.includes(i)) available.push(i);
            }
            if(available.length > 0) {
                // åšä¸€å€‹ç°¡å–®çš„å‹•ç•«æ•ˆæœ (å‡è£åœ¨è·‘)
                let tempRun = setInterval(() => {
                    document.getElementById('current-num').innerText = Math.floor(Math.random() * 75) + 1;
                }, 50);

                setTimeout(() => {
                    clearInterval(tempRun);
                    let num = available[Math.floor(Math.random() * available.length)];
                    socket.emit('draw_number', {number: num});
                }, 500); // è·‘0.5ç§’å¾Œé€å‡º
            } else {
                alert("æ‰€æœ‰è™Ÿç¢¼éƒ½é–‹å®Œäº†ï¼");
            }
        }

        function resetGame() {
            if(confirm("ç¢ºå®šè¦è¸¢é™¤æ‰€æœ‰ç©å®¶ä¸¦é‡ç½®éŠæˆ²å—ï¼Ÿ")) socket.emit('reset_game');
        }

        // æ¥æ”¶ä¼ºæœå™¨æ›´æ–°
        socket.on('admin_update', (data) => {
            // æ›´æ–°äººæ•¸
            document.getElementById('p-count').innerText = data.count;
            
            // æ›´æ–°è™Ÿç¢¼
            drawnNumbers = data.drawn;
            if(drawnNumbers.length > 0)
                document.getElementById('current-num').innerText = drawnNumbers[drawnNumbers.length-1];
            else
                document.getElementById('current-num').innerText = "--";

            // æ›´æ–°æ’è¡Œæ¦œ
            const list = document.getElementById('leaderboard');
            list.innerHTML = "";
            
            // è®“è½ç‰Œçš„äººæ’åœ¨ Bingo å¾Œé¢ï¼Œä½†åœ¨æ™®é€šäººå‰é¢
            data.players.forEach((p, index) => {
                let li = document.createElement('li');
                let statusHtml = '<span style="color:#95a5a6">ç­‰å¾…ä¸­...</span>';
                
                if(p.status === "BINGO") {
                    li.classList.add('status-bingo');
                    statusHtml = 'ğŸ‰ BINGO!';
                } else if(p.status === "REACH") {
                    li.classList.add('status-reach');
                    statusHtml = 'ğŸ”¥ è½ç‰Œ!';
                }
                
                li.innerHTML = `
                    <span>#${index + 1} <strong>${p.name}</strong></span>
                    <span>${statusHtml}</span>
                `;
                list.appendChild(li);
            });
        });
    </script>
</body>
</html>
